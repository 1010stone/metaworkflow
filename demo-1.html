<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Meta-Workflow</title>
  <meta name="description" content="This is a workflow for metabolomics studies.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Meta-Workflow" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/cover.png" />
  <meta property="og:description" content="This is a workflow for metabolomics studies." />
  <meta name="github-repo" content="yufree/metaworkflow" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Meta-Workflow" />
  
  <meta name="twitter:description" content="This is a workflow for metabolomics studies." />
  <meta name="twitter:image" content="images/cover.png" />

<meta name="author" content="Miao YU">


<meta name="date" content="2018-11-27">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="workflow-2.html">
<link rel="next" href="exposome.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<script src="libs/viz-0.3/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.0/grViz.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Metabolomics Workflow</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#history"><i class="fa fa-check"></i><b>1.1</b> History</a><ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#history-of-mass-spectrometry"><i class="fa fa-check"></i><b>1.1.1</b> History of Mass Spectrometry</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#history-of-metabolomcis"><i class="fa fa-check"></i><b>1.1.2</b> History of Metabolomcis</a></li>
<li class="chapter" data-level="1.1.3" data-path="introduction.html"><a href="introduction.html#defination"><i class="fa fa-check"></i><b>1.1.3</b> Defination</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#reviews-and-tutorials"><i class="fa fa-check"></i><b>1.2</b> Reviews and tutorials</a><ul>
<li class="chapter" data-level="1.2.1" data-path="introduction.html"><a href="introduction.html#workflow"><i class="fa fa-check"></i><b>1.2.1</b> Workflow</a></li>
<li class="chapter" data-level="1.2.2" data-path="introduction.html"><a href="introduction.html#data-analysis"><i class="fa fa-check"></i><b>1.2.2</b> Data analysis</a></li>
<li class="chapter" data-level="1.2.3" data-path="introduction.html"><a href="introduction.html#application"><i class="fa fa-check"></i><b>1.2.3</b> Application</a></li>
<li class="chapter" data-level="1.2.4" data-path="introduction.html"><a href="introduction.html#challenge"><i class="fa fa-check"></i><b>1.2.4</b> Challenge</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#trends-in-metabolomics"><i class="fa fa-check"></i><b>1.3</b> Trends in Metabolomics</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#workflow-1"><i class="fa fa-check"></i><b>1.4</b> Workflow</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exprimental-designdoe.html"><a href="exprimental-designdoe.html"><i class="fa fa-check"></i><b>2</b> Exprimental design(DoE)</a><ul>
<li class="chapter" data-level="2.1" data-path="exprimental-designdoe.html"><a href="exprimental-designdoe.html#software"><i class="fa fa-check"></i><b>2.1</b> Software</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="pretreatment.html"><a href="pretreatment.html"><i class="fa fa-check"></i><b>3</b> Pretreatment</a><ul>
<li class="chapter" data-level="3.1" data-path="pretreatment.html"><a href="pretreatment.html#quenching"><i class="fa fa-check"></i><b>3.1</b> Quenching</a></li>
<li class="chapter" data-level="3.2" data-path="pretreatment.html"><a href="pretreatment.html#extraction"><i class="fa fa-check"></i><b>3.2</b> Extraction</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="instrumental-analysis.html"><a href="instrumental-analysis.html"><i class="fa fa-check"></i><b>4</b> Instrumental analysis</a></li>
<li class="chapter" data-level="5" data-path="raw-data-pretreatment.html"><a href="raw-data-pretreatment.html"><i class="fa fa-check"></i><b>5</b> Raw data pretreatment</a><ul>
<li class="chapter" data-level="5.1" data-path="raw-data-pretreatment.html"><a href="raw-data-pretreatment.html#peak-extraction"><i class="fa fa-check"></i><b>5.1</b> Peak extraction</a></li>
<li class="chapter" data-level="5.2" data-path="raw-data-pretreatment.html"><a href="raw-data-pretreatment.html#retention-time-correction"><i class="fa fa-check"></i><b>5.2</b> Retention Time Correction</a></li>
<li class="chapter" data-level="5.3" data-path="raw-data-pretreatment.html"><a href="raw-data-pretreatment.html#filling-missing-values"><i class="fa fa-check"></i><b>5.3</b> Filling missing values</a></li>
<li class="chapter" data-level="5.4" data-path="raw-data-pretreatment.html"><a href="raw-data-pretreatment.html#spectral-deconvolution"><i class="fa fa-check"></i><b>5.4</b> Spectral deconvolution</a></li>
<li class="chapter" data-level="5.5" data-path="raw-data-pretreatment.html"><a href="raw-data-pretreatment.html#dynamic-range"><i class="fa fa-check"></i><b>5.5</b> Dynamic Range</a><ul>
<li class="chapter" data-level="5.5.1" data-path="raw-data-pretreatment.html"><a href="raw-data-pretreatment.html#non-detects"><i class="fa fa-check"></i><b>5.5.1</b> Non-detects</a></li>
<li class="chapter" data-level="5.5.2" data-path="raw-data-pretreatment.html"><a href="raw-data-pretreatment.html#over-detection-limit"><i class="fa fa-check"></i><b>5.5.2</b> Over Detection Limit</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="raw-data-pretreatment.html"><a href="raw-data-pretreatment.html#software-1"><i class="fa fa-check"></i><b>5.6</b> Software</a><ul>
<li class="chapter" data-level="5.6.1" data-path="raw-data-pretreatment.html"><a href="raw-data-pretreatment.html#peak-picking"><i class="fa fa-check"></i><b>5.6.1</b> Peak picking</a></li>
<li class="chapter" data-level="5.6.2" data-path="raw-data-pretreatment.html"><a href="raw-data-pretreatment.html#for-msms"><i class="fa fa-check"></i><b>5.6.2</b> For MS/MS</a></li>
<li class="chapter" data-level="5.6.3" data-path="raw-data-pretreatment.html"><a href="raw-data-pretreatment.html#improved-peak-picking"><i class="fa fa-check"></i><b>5.6.3</b> Improved Peak picking</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="peaks-normalization.html"><a href="peaks-normalization.html"><i class="fa fa-check"></i><b>6</b> Peaks normalization</a><ul>
<li class="chapter" data-level="6.1" data-path="peaks-normalization.html"><a href="peaks-normalization.html#peak-misidentification"><i class="fa fa-check"></i><b>6.1</b> Peak misidentification</a></li>
<li class="chapter" data-level="6.2" data-path="peaks-normalization.html"><a href="peaks-normalization.html#rsd-filter"><i class="fa fa-check"></i><b>6.2</b> RSD Filter</a></li>
<li class="chapter" data-level="6.3" data-path="peaks-normalization.html"><a href="peaks-normalization.html#power-analysis-filter"><i class="fa fa-check"></i><b>6.3</b> Power Analysis Filter</a></li>
<li class="chapter" data-level="6.4" data-path="peaks-normalization.html"><a href="peaks-normalization.html#normalization"><i class="fa fa-check"></i><b>6.4</b> Normalization</a><ul>
<li class="chapter" data-level="6.4.1" data-path="peaks-normalization.html"><a href="peaks-normalization.html#unsupervised-methods"><i class="fa fa-check"></i><b>6.4.1</b> Unsupervised methods</a></li>
<li class="chapter" data-level="6.4.2" data-path="peaks-normalization.html"><a href="peaks-normalization.html#supervised-methods"><i class="fa fa-check"></i><b>6.4.2</b> Supervised methods</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="peaks-normalization.html"><a href="peaks-normalization.html#software-2"><i class="fa fa-check"></i><b>6.5</b> Software</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="annotation.html"><a href="annotation.html"><i class="fa fa-check"></i><b>7</b> Annotation</a><ul>
<li class="chapter" data-level="7.1" data-path="annotation.html"><a href="annotation.html#issues-in-annotation"><i class="fa fa-check"></i><b>7.1</b> Issues in annotation</a></li>
<li class="chapter" data-level="7.2" data-path="annotation.html"><a href="annotation.html#annotation-v.s.-identification"><i class="fa fa-check"></i><b>7.2</b> Annotation v.s. identification</a></li>
<li class="chapter" data-level="7.3" data-path="annotation.html"><a href="annotation.html#ms-database-for-annotation"><i class="fa fa-check"></i><b>7.3</b> MS Database for annotation</a><ul>
<li class="chapter" data-level="7.3.1" data-path="annotation.html"><a href="annotation.html#msms"><i class="fa fa-check"></i><b>7.3.1</b> MS/MS</a></li>
<li class="chapter" data-level="7.3.2" data-path="annotation.html"><a href="annotation.html#ms"><i class="fa fa-check"></i><b>7.3.2</b> MS</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="annotation.html"><a href="annotation.html#compounds-database"><i class="fa fa-check"></i><b>7.4</b> Compounds Database</a></li>
<li class="chapter" data-level="7.5" data-path="annotation.html"><a href="annotation.html#software-3"><i class="fa fa-check"></i><b>7.5</b> Software</a><ul>
<li class="chapter" data-level="7.5.1" data-path="annotation.html"><a href="annotation.html#adducts-list"><i class="fa fa-check"></i><b>7.5.1</b> Adducts list</a></li>
<li class="chapter" data-level="7.5.2" data-path="annotation.html"><a href="annotation.html#molgen"><i class="fa fa-check"></i><b>7.5.2</b> Molgen</a></li>
<li class="chapter" data-level="7.5.3" data-path="annotation.html"><a href="annotation.html#isotope"><i class="fa fa-check"></i><b>7.5.3</b> Isotope</a></li>
<li class="chapter" data-level="7.5.4" data-path="annotation.html"><a href="annotation.html#mffinder"><i class="fa fa-check"></i><b>7.5.4</b> mfFinder</a></li>
<li class="chapter" data-level="7.5.5" data-path="annotation.html"><a href="annotation.html#camera"><i class="fa fa-check"></i><b>7.5.5</b> CAMERA</a></li>
<li class="chapter" data-level="7.5.6" data-path="annotation.html"><a href="annotation.html#ramclustr"><i class="fa fa-check"></i><b>7.5.6</b> RAMClustR</a></li>
<li class="chapter" data-level="7.5.7" data-path="annotation.html"><a href="annotation.html#pmd"><i class="fa fa-check"></i><b>7.5.7</b> pmd</a></li>
<li class="chapter" data-level="7.5.8" data-path="annotation.html"><a href="annotation.html#nontarget"><i class="fa fa-check"></i><b>7.5.8</b> nontarget</a></li>
<li class="chapter" data-level="7.5.9" data-path="annotation.html"><a href="annotation.html#xmsannotator"><i class="fa fa-check"></i><b>7.5.9</b> xMSannotator</a></li>
<li class="chapter" data-level="7.5.10" data-path="annotation.html"><a href="annotation.html#cfm-id"><i class="fa fa-check"></i><b>7.5.10</b> CFM-ID</a></li>
<li class="chapter" data-level="7.5.11" data-path="annotation.html"><a href="annotation.html#mine"><i class="fa fa-check"></i><b>7.5.11</b> MINE</a></li>
<li class="chapter" data-level="7.5.12" data-path="annotation.html"><a href="annotation.html#interpretmsspectrum"><i class="fa fa-check"></i><b>7.5.12</b> InterpretMSSpectrum</a></li>
<li class="chapter" data-level="7.5.13" data-path="annotation.html"><a href="annotation.html#for-ident"><i class="fa fa-check"></i><b>7.5.13</b> For Ident</a></li>
<li class="chapter" data-level="7.5.14" data-path="annotation.html"><a href="annotation.html#mzmatch"><i class="fa fa-check"></i><b>7.5.14</b> mzmatch</a></li>
<li class="chapter" data-level="7.5.15" data-path="annotation.html"><a href="annotation.html#mz.unity"><i class="fa fa-check"></i><b>7.5.15</b> mz.unity</a></li>
<li class="chapter" data-level="7.5.16" data-path="annotation.html"><a href="annotation.html#mait"><i class="fa fa-check"></i><b>7.5.16</b> MAIT</a></li>
<li class="chapter" data-level="7.5.17" data-path="annotation.html"><a href="annotation.html#probmetab"><i class="fa fa-check"></i><b>7.5.17</b> ProbMetab</a></li>
<li class="chapter" data-level="7.5.18" data-path="annotation.html"><a href="annotation.html#ramsi"><i class="fa fa-check"></i><b>7.5.18</b> RAMSI</a></li>
<li class="chapter" data-level="7.5.19" data-path="annotation.html"><a href="annotation.html#sirius"><i class="fa fa-check"></i><b>7.5.19</b> Sirius</a></li>
<li class="chapter" data-level="7.5.20" data-path="annotation.html"><a href="annotation.html#mi-pack"><i class="fa fa-check"></i><b>7.5.20</b> MI-Pack</a></li>
<li class="chapter" data-level="7.5.21" data-path="annotation.html"><a href="annotation.html#plantmat"><i class="fa fa-check"></i><b>7.5.21</b> Plantmat</a></li>
<li class="chapter" data-level="7.5.22" data-path="annotation.html"><a href="annotation.html#metfamily"><i class="fa fa-check"></i><b>7.5.22</b> MetFamily</a></li>
<li class="chapter" data-level="7.5.23" data-path="annotation.html"><a href="annotation.html#lipidmatch"><i class="fa fa-check"></i><b>7.5.23</b> Lipidmatch</a></li>
<li class="chapter" data-level="7.5.24" data-path="annotation.html"><a href="annotation.html#molfind"><i class="fa fa-check"></i><b>7.5.24</b> MolFind</a></li>
<li class="chapter" data-level="7.5.25" data-path="annotation.html"><a href="annotation.html#metfusion"><i class="fa fa-check"></i><b>7.5.25</b> MetFusion</a></li>
<li class="chapter" data-level="7.5.26" data-path="annotation.html"><a href="annotation.html#imet"><i class="fa fa-check"></i><b>7.5.26</b> iMet</a></li>
<li class="chapter" data-level="7.5.27" data-path="annotation.html"><a href="annotation.html#metscape"><i class="fa fa-check"></i><b>7.5.27</b> Metscape</a></li>
<li class="chapter" data-level="7.5.28" data-path="annotation.html"><a href="annotation.html#metfrag"><i class="fa fa-check"></i><b>7.5.28</b> MetFrag</a></li>
<li class="chapter" data-level="7.5.29" data-path="annotation.html"><a href="annotation.html#lipidfrag"><i class="fa fa-check"></i><b>7.5.29</b> LipidFrag</a></li>
<li class="chapter" data-level="7.5.30" data-path="annotation.html"><a href="annotation.html#mycompoundid"><i class="fa fa-check"></i><b>7.5.30</b> MycompoundID</a></li>
<li class="chapter" data-level="7.5.31" data-path="annotation.html"><a href="annotation.html#magma"><i class="fa fa-check"></i><b>7.5.31</b> magma</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="annotation.html"><a href="annotation.html#ms-dia"><i class="fa fa-check"></i><b>7.6</b> MS-DIA</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="omics-analysis.html"><a href="omics-analysis.html"><i class="fa fa-check"></i><b>8</b> Omics analysis</a><ul>
<li class="chapter" data-level="8.1" data-path="omics-analysis.html"><a href="omics-analysis.html#pathway-analysis"><i class="fa fa-check"></i><b>8.1</b> Pathway analysis</a><ul>
<li class="chapter" data-level="8.1.1" data-path="omics-analysis.html"><a href="omics-analysis.html#pathway-database"><i class="fa fa-check"></i><b>8.1.1</b> Pathway Database</a></li>
<li class="chapter" data-level="8.1.2" data-path="omics-analysis.html"><a href="omics-analysis.html#pathway-software"><i class="fa fa-check"></i><b>8.1.2</b> Pathway software</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="omics-analysis.html"><a href="omics-analysis.html#network-analysis"><i class="fa fa-check"></i><b>8.2</b> Network analysis</a></li>
<li class="chapter" data-level="8.3" data-path="omics-analysis.html"><a href="omics-analysis.html#omics-integration"><i class="fa fa-check"></i><b>8.3</b> Omics integration</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="common-analysis-methods-for-metabolomics.html"><a href="common-analysis-methods-for-metabolomics.html"><i class="fa fa-check"></i><b>9</b> Common analysis methods for metabolomics</a><ul>
<li class="chapter" data-level="9.1" data-path="common-analysis-methods-for-metabolomics.html"><a href="common-analysis-methods-for-metabolomics.html#basic-statistical-analysis"><i class="fa fa-check"></i><b>9.1</b> Basic Statistical Analysis</a></li>
<li class="chapter" data-level="9.2" data-path="common-analysis-methods-for-metabolomics.html"><a href="common-analysis-methods-for-metabolomics.html#differences-analysis"><i class="fa fa-check"></i><b>9.2</b> Differences analysis</a></li>
<li class="chapter" data-level="9.3" data-path="common-analysis-methods-for-metabolomics.html"><a href="common-analysis-methods-for-metabolomics.html#pca"><i class="fa fa-check"></i><b>9.3</b> PCA</a></li>
<li class="chapter" data-level="9.4" data-path="common-analysis-methods-for-metabolomics.html"><a href="common-analysis-methods-for-metabolomics.html#cluster-analysis"><i class="fa fa-check"></i><b>9.4</b> Cluster Analysis</a></li>
<li class="chapter" data-level="9.5" data-path="common-analysis-methods-for-metabolomics.html"><a href="common-analysis-methods-for-metabolomics.html#plsda"><i class="fa fa-check"></i><b>9.5</b> PLSDA</a></li>
<li class="chapter" data-level="9.6" data-path="common-analysis-methods-for-metabolomics.html"><a href="common-analysis-methods-for-metabolomics.html#self-organizing-map"><i class="fa fa-check"></i><b>9.6</b> Self-organizing map</a></li>
<li class="chapter" data-level="9.7" data-path="common-analysis-methods-for-metabolomics.html"><a href="common-analysis-methods-for-metabolomics.html#canonical-correlation-analysis"><i class="fa fa-check"></i><b>9.7</b> Canonical correlation analysis</a></li>
<li class="chapter" data-level="9.8" data-path="common-analysis-methods-for-metabolomics.html"><a href="common-analysis-methods-for-metabolomics.html#software-4"><i class="fa fa-check"></i><b>9.8</b> Software</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="workflow-2.html"><a href="workflow-2.html"><i class="fa fa-check"></i><b>10</b> Workflow</a><ul>
<li class="chapter" data-level="10.1" data-path="workflow-2.html"><a href="workflow-2.html#platform-for-metabolomics"><i class="fa fa-check"></i><b>10.1</b> Platform for metabolomics</a><ul>
<li class="chapter" data-level="10.1.1" data-path="workflow-2.html"><a href="workflow-2.html#xcms-online"><i class="fa fa-check"></i><b>10.1.1</b> XCMS online</a></li>
<li class="chapter" data-level="10.1.2" data-path="workflow-2.html"><a href="workflow-2.html#prime"><i class="fa fa-check"></i><b>10.1.2</b> PRIMe</a></li>
<li class="chapter" data-level="10.1.3" data-path="workflow-2.html"><a href="workflow-2.html#openms"><i class="fa fa-check"></i><b>10.1.3</b> OpenMS</a></li>
<li class="chapter" data-level="10.1.4" data-path="workflow-2.html"><a href="workflow-2.html#mzmine-2"><i class="fa fa-check"></i><b>10.1.4</b> MZmine 2</a></li>
<li class="chapter" data-level="10.1.5" data-path="workflow-2.html"><a href="workflow-2.html#xcms"><i class="fa fa-check"></i><b>10.1.5</b> XCMS</a></li>
<li class="chapter" data-level="10.1.6" data-path="workflow-2.html"><a href="workflow-2.html#emory-mahpic"><i class="fa fa-check"></i><b>10.1.6</b> Emory MaHPIC</a></li>
<li class="chapter" data-level="10.1.7" data-path="workflow-2.html"><a href="workflow-2.html#dia-data-analysis"><i class="fa fa-check"></i><b>10.1.7</b> DIA data analysis</a></li>
<li class="chapter" data-level="10.1.8" data-path="workflow-2.html"><a href="workflow-2.html#others"><i class="fa fa-check"></i><b>10.1.8</b> Others</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="workflow-2.html"><a href="workflow-2.html#data-sharing"><i class="fa fa-check"></i><b>10.2</b> Data sharing</a></li>
<li class="chapter" data-level="10.3" data-path="workflow-2.html"><a href="workflow-2.html#contest"><i class="fa fa-check"></i><b>10.3</b> Contest</a></li>
<li class="chapter" data-level="10.4" data-path="workflow-2.html"><a href="workflow-2.html#demo"><i class="fa fa-check"></i><b>10.4</b> Demo</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="demo-1.html"><a href="demo-1.html"><i class="fa fa-check"></i><b>11</b> Demo</a><ul>
<li class="chapter" data-level="11.1" data-path="demo-1.html"><a href="demo-1.html#project-setup"><i class="fa fa-check"></i><b>11.1</b> Project Setup</a></li>
<li class="chapter" data-level="11.2" data-path="demo-1.html"><a href="demo-1.html#data-input"><i class="fa fa-check"></i><b>11.2</b> Data input</a></li>
<li class="chapter" data-level="11.3" data-path="demo-1.html"><a href="demo-1.html#optimization"><i class="fa fa-check"></i><b>11.3</b> Optimization</a></li>
<li class="chapter" data-level="11.4" data-path="demo-1.html"><a href="demo-1.html#wrap-function"><i class="fa fa-check"></i><b>11.4</b> Wrap function</a><ul>
<li class="chapter" data-level="11.4.1" data-path="demo-1.html"><a href="demo-1.html#peak-picking-1"><i class="fa fa-check"></i><b>11.4.1</b> Peak picking</a></li>
<li class="chapter" data-level="11.4.2" data-path="demo-1.html"><a href="demo-1.html#data-correction"><i class="fa fa-check"></i><b>11.4.2</b> Data correction</a></li>
<li class="chapter" data-level="11.4.3" data-path="demo-1.html"><a href="demo-1.html#peaks-filling"><i class="fa fa-check"></i><b>11.4.3</b> Peaks filling</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="demo-1.html"><a href="demo-1.html#peaks-list"><i class="fa fa-check"></i><b>11.5</b> Peaks list</a></li>
<li class="chapter" data-level="11.6" data-path="demo-1.html"><a href="demo-1.html#peaks-filtering"><i class="fa fa-check"></i><b>11.6</b> Peaks filtering</a></li>
<li class="chapter" data-level="11.7" data-path="demo-1.html"><a href="demo-1.html#normalization-optional"><i class="fa fa-check"></i><b>11.7</b> Normalization (Optional)</a></li>
<li class="chapter" data-level="11.8" data-path="demo-1.html"><a href="demo-1.html#statistic-analysis"><i class="fa fa-check"></i><b>11.8</b> Statistic analysis</a></li>
<li class="chapter" data-level="11.9" data-path="demo-1.html"><a href="demo-1.html#annotation-1"><i class="fa fa-check"></i><b>11.9</b> Annotation</a></li>
<li class="chapter" data-level="11.10" data-path="demo-1.html"><a href="demo-1.html#pathway-analysis-1"><i class="fa fa-check"></i><b>11.10</b> Pathway Analysis</a></li>
<li class="chapter" data-level="11.11" data-path="demo-1.html"><a href="demo-1.html#metaboanalyst"><i class="fa fa-check"></i><b>11.11</b> MetaboAnalyst</a></li>
<li class="chapter" data-level="11.12" data-path="demo-1.html"><a href="demo-1.html#summary"><i class="fa fa-check"></i><b>11.12</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="exposome.html"><a href="exposome.html"><i class="fa fa-check"></i><b>12</b> Exposome</a><ul>
<li class="chapter" data-level="12.1" data-path="exposome.html"><a href="exposome.html#internal-exposure"><i class="fa fa-check"></i><b>12.1</b> Internal exposure</a></li>
<li class="chapter" data-level="12.2" data-path="exposome.html"><a href="exposome.html#external-exposure"><i class="fa fa-check"></i><b>12.2</b> External exposure</a><ul>
<li class="chapter" data-level="12.2.1" data-path="exposome.html"><a href="exposome.html#environmental-fate-of-compounds"><i class="fa fa-check"></i><b>12.2.1</b> Environmental fate of compounds</a></li>
<li class="chapter" data-level="12.2.2" data-path="exposome.html"><a href="exposome.html#exposure-study-database"><i class="fa fa-check"></i><b>12.2.2</b> Exposure study database</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/yufree/metaworkflow" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Meta-Workflow</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="demo-1" class="section level1">
<h1><span class="header-section-number">Chapter 11</span> Demo</h1>
<div id="project-setup" class="section level2">
<h2><span class="header-section-number">11.1</span> Project Setup</h2>
<p>I suggest building your data analysis projects in RStudio(Click File - New project - New dictionary - Empty project). Then assign a name for your project. I also recommend the following tips if you are familiar with it.</p>
<ul>
<li><p>Use <a href="https://git-scm.com/">git</a>/<a href="https://github.com/">github</a> to make version control of your code and sync your project online.</p></li>
<li><p>NOT use your name for your project because other peoples might cooperate with you and someone might check your data when you publish your papers. Each project should be a work for one paper or one chapter in your thesis.</p></li>
<li><p>Use <strong>workflow</strong> document(txt or doc) in your project to record all of the steps and code you performed for this project. Treat this document as digital version of your experiment notebook</p></li>
<li><p>Use <strong>data</strong> folder in your project folder for the raw data and the results you get in data analysis</p></li>
<li><p>Use <strong>figure</strong> folder in your project folder for the figure</p></li>
<li><p>Use <strong>munuscript</strong> folder in your project folder for the manuscript (you could write paper in rstudio with the help of template in <a href="https://github.com/rstudio/rticles">Rmarkdown</a>)</p></li>
<li><p>Just double click <strong>[yourprojectname].Rproj</strong> to start your project</p></li>
</ul>
</div>
<div id="data-input" class="section level2">
<h2><span class="header-section-number">11.2</span> Data input</h2>
<p><strong>xcms</strong> does not support all of the Raw files from every mass spectrometry manufacturers. You need to convert your Raw data into some open-source <a href="https://en.wikipedia.org/wiki/Mass_spectrometry_data_format">data format</a> such as mzData, mzXML or CDF files. The tool is <strong>MScovert</strong> from <a href="http://proteowizard.sourceforge.net/"><strong>ProteoWizard</strong></a>.</p>
</div>
<div id="optimization" class="section level2">
<h2><span class="header-section-number">11.3</span> Optimization</h2>
<p>IPO package could be used to optimaze the parameters for XCMS. Try the following code.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(IPO)
<span class="kw">library</span>(xcms)
peakpickingParameters &lt;-<span class="st"> </span><span class="kw">getDefaultXcmsSetStartingParams</span>(<span class="st">&#39;centWave&#39;</span>)
path &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="st">&#39;D:/metademo/data/oq/&#39;</span>,<span class="dt">full.names =</span> T,<span class="dt">recursive =</span> T)
<span class="co"># change to 5 for obitrap</span>
peakpickingParameters<span class="op">$</span>ppm &lt;-<span class="st"> </span><span class="dv">15</span>
resultPeakpicking &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">optimizeXcmsSet</span>(<span class="dt">files =</span> path[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)], 
                  <span class="dt">params =</span> peakpickingParameters,
                  <span class="dt">nSlaves =</span> <span class="dv">1</span>,
                  <span class="dt">subdir =</span> <span class="ot">NULL</span>)

optimizedXcmsSetObject &lt;-<span class="st"> </span>resultPeakpicking<span class="op">$</span>best_settings<span class="op">$</span>xset
retcorGroupParameters &lt;-<span class="st"> </span><span class="kw">getDefaultRetGroupStartingParams</span>()
resultRetcorGroup &lt;-
<span class="st">  </span><span class="kw">optimizeRetGroup</span>(<span class="dt">xset =</span> optimizedXcmsSetObject, 
                   <span class="dt">params =</span> retcorGroupParameters, 
                   <span class="dt">subdir =</span> <span class="ot">NULL</span>)
<span class="kw">writeRScript</span>(resultPeakpicking<span class="op">$</span>best_settings<span class="op">$</span>parameters, 
             resultRetcorGroup<span class="op">$</span>best_settings)
para &lt;-<span class="st"> </span><span class="kw">capture.output</span>(<span class="kw">writeRScript</span>(resultPeakpicking<span class="op">$</span>best_settings<span class="op">$</span>parameters, resultRetcorGroup<span class="op">$</span>best_settings), <span class="dt">type =</span> <span class="st">&quot;message&quot;</span>)
<span class="kw">save</span>(para,<span class="dt">file =</span> <span class="st">&#39;para.RData&#39;</span>)
<span class="kw">sessionInfo</span>()</code></pre>
</div>
<div id="wrap-function" class="section level2">
<h2><span class="header-section-number">11.4</span> Wrap function</h2>
<p>Here we would use the optimized parameters for peak picking, retention time correction and peaks filling.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(xcms)
<span class="kw">library</span>(Rmpi)
<span class="kw">library</span>(stringr)
getrtmz &lt;-<span class="st"> </span><span class="cf">function</span>(path,<span class="dt">index =</span> <span class="ot">NULL</span>){
  <span class="kw">load</span>(<span class="st">&#39;para.RData&#39;</span>)
peakwidth &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(para[<span class="kw">grepl</span>(<span class="st">&#39;peakwidth&#39;</span>,para)],<span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+</span><span class="ch">\\</span><span class="st">.*</span><span class="ch">\\</span><span class="st">d*&#39;</span>)))
ppm &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(para[<span class="kw">grepl</span>(<span class="st">&#39;ppm&#39;</span>,para)],<span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+&#39;</span>)))
noise &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(para[<span class="kw">grepl</span>(<span class="st">&#39;noise&#39;</span>,para)],<span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+&#39;</span>)))
snthresh &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(para[<span class="kw">grepl</span>(<span class="st">&#39;snthresh&#39;</span>,para)],<span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+&#39;</span>)))
mzdiff &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(para[<span class="kw">grepl</span>(<span class="st">&#39;mzdiff&#39;</span>,para)],<span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+</span><span class="ch">\\</span><span class="st">.*</span><span class="ch">\\</span><span class="st">d*&#39;</span>)))
prefilter &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(para[<span class="kw">grepl</span>(<span class="st">&#39;prefilter&#39;</span>,para)],<span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+</span><span class="ch">\\</span><span class="st">.*</span><span class="ch">\\</span><span class="st">d*&#39;</span>)))
integrate &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(para[<span class="kw">grepl</span>(<span class="st">&#39;integrate&#39;</span>,para)],<span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+&#39;</span>)))
profStep &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(para[<span class="kw">grepl</span>(<span class="st">&#39;profStep&#39;</span>,para)],<span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+</span><span class="ch">\\</span><span class="st">.*</span><span class="ch">\\</span><span class="st">d*&#39;</span>))),<span class="dv">1</span>)
center &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(para[<span class="kw">grepl</span>(<span class="st">&#39;center&#39;</span>,para)],<span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+&#39;</span>)))
response &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(para[<span class="kw">grepl</span>(<span class="st">&#39;response&#39;</span>,para)],<span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+&#39;</span>)))
gapInit &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(para[<span class="kw">grepl</span>(<span class="st">&#39;gapInit&#39;</span>,para)],<span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+</span><span class="ch">\\</span><span class="st">.*</span><span class="ch">\\</span><span class="st">d*&#39;</span>)))
gapExtend &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(para[<span class="kw">grepl</span>(<span class="st">&#39;gapExtend&#39;</span>,para)],<span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+</span><span class="ch">\\</span><span class="st">.*</span><span class="ch">\\</span><span class="st">d*&#39;</span>)))
factorDiag &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(para[<span class="kw">grepl</span>(<span class="st">&#39;factorDiag&#39;</span>,para)],<span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+&#39;</span>)))
factorGap &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(para[<span class="kw">grepl</span>(<span class="st">&#39;factorGap&#39;</span>,para)],<span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+&#39;</span>)))
localAlignment &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(para[<span class="kw">grepl</span>(<span class="st">&#39;localAlignment&#39;</span>,para)],<span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+&#39;</span>)))
bw &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(para[<span class="kw">grepl</span>(<span class="st">&#39;bw&#39;</span>,para)],<span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+</span><span class="ch">\\</span><span class="st">.*</span><span class="ch">\\</span><span class="st">d*&#39;</span>)))
mzwid &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(para[<span class="kw">grepl</span>(<span class="st">&#39;mzwid&#39;</span>,para)],<span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+</span><span class="ch">\\</span><span class="st">.*</span><span class="ch">\\</span><span class="st">d*&#39;</span>)))
minfrac &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(para[<span class="kw">grepl</span>(<span class="st">&#39;minfrac&#39;</span>,para)],<span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+</span><span class="ch">\\</span><span class="st">.*</span><span class="ch">\\</span><span class="st">d*&#39;</span>)))
minsamp &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(para[<span class="kw">grepl</span>(<span class="st">&#39;minsamp&#39;</span>,para)],<span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+&#39;</span>)))
max &lt;-<span class="st">  </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(para[<span class="kw">grepl</span>(<span class="st">&#39;max&#39;</span>,para)],<span class="st">&#39;</span><span class="ch">\\</span><span class="st">d+&#39;</span>)))
  files &lt;-<span class="st"> </span><span class="kw">list.files</span>(path,<span class="dt">full.names =</span> T,<span class="dt">recursive =</span> T)
  <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.null</span>(index)){
    files &lt;-<span class="st"> </span>files[index]
  }
  xset &lt;-<span class="st"> </span><span class="kw">xcmsSet</span>(files,
  <span class="dt">method =</span> <span class="st">&quot;centWave&quot;</span>,
  <span class="dt">peakwidth       =</span> peakwidth,
  <span class="dt">ppm             =</span> ppm,
  <span class="dt">noise           =</span> noise,
  <span class="dt">snthresh        =</span> snthresh,
  <span class="dt">mzdiff          =</span> mzdiff,
  <span class="dt">prefilter       =</span> prefilter,
  <span class="dt">mzCenterFun     =</span> <span class="st">&quot;wMean&quot;</span>,
  <span class="dt">integrate       =</span> integrate,
  <span class="dt">fitgauss        =</span> <span class="ot">FALSE</span>,
  <span class="dt">verbose.columns =</span> <span class="ot">FALSE</span>)
xset &lt;-<span class="st"> </span><span class="kw">retcor</span>( 
  xset,
  <span class="dt">method         =</span> <span class="st">&quot;obiwarp&quot;</span>,
  <span class="dt">plottype       =</span> <span class="st">&quot;none&quot;</span>,
  <span class="dt">distFunc       =</span> <span class="st">&quot;cor_opt&quot;</span>,
  <span class="dt">profStep       =</span> profStep,
  <span class="dt">center         =</span> center,
  <span class="dt">response       =</span> response,
  <span class="dt">gapInit        =</span> gapInit,
  <span class="dt">gapExtend      =</span> gapExtend,
  <span class="dt">factorDiag     =</span> factorDiag,
  <span class="dt">factorGap      =</span> factorGap,
  <span class="dt">localAlignment =</span> localAlignment)
xset &lt;-<span class="st"> </span><span class="kw">group</span>( 
  xset,
  <span class="dt">method  =</span> <span class="st">&quot;density&quot;</span>,
  <span class="dt">bw      =</span> bw,
  <span class="dt">mzwid   =</span> mzwid,
  <span class="dt">minfrac =</span> minfrac,
  <span class="dt">minsamp =</span> minsamp,
  <span class="dt">max     =</span> max)

xset &lt;-<span class="st"> </span><span class="kw">fillPeaks</span>(xset)
<span class="kw">return</span>(xset)
}</code></pre>
<div id="peak-picking-1" class="section level3">
<h3><span class="header-section-number">11.4.1</span> Peak picking</h3>
<p>The first step to process the MS data is that find the peaks against the noises. In <strong>xcms</strong>, all of related staffs are handled by <em>xcmsSet</em> function.</p>
<p>For any functions in <strong>xcms</strong> or <strong>R</strong>, you could get their documents by type <code>?</code> before certain function. Another geek way is input the name of the function in the console of Rstudio and press F1 for help.</p>
<pre class="sourceCode r"><code class="sourceCode r">?xcmsSet</code></pre>
<p>In the document of <em>xcmsset</em>, we could set the sample classes, profmethod, profparam, polarity,etc. In the online version, such configurations are shown in certain windows. In the local analysis environment, such parameters are setup by yourselves. However, I think the default configurations could satisfied most of the analysis because related information should have been recorded in your Raw data and <strong>xcms</strong> could find them. All you need to do is that show the data dictionary for <em>xcmsSet</em>.</p>
<p>If your data have many groups such as control and treated group, just put them in separate subfolder of the data folder and <em>xcmsSet</em> would read them as separated groups.</p>
</div>
<div id="data-correction" class="section level3">
<h3><span class="header-section-number">11.4.2</span> Data correction</h3>
<p>Reasons of data correction might come from many aspects such as the unstable instrument and pollution on column. In <strong>xcms</strong>, the most important correction is retention time correction. Remember the original retention time might changed and use another object to save the new object.</p>
</div>
<div id="peaks-filling" class="section level3">
<h3><span class="header-section-number">11.4.3</span> Peaks filling</h3>
<p>After the retention time correction, filling the missing peaks could be done by <em>fillpeaks</em>. Peaks filling could avoid two many NAs for false statistical analysis. The algorithm could use the baseline signal to impute the data.</p>
</div>
</div>
<div id="peaks-list" class="section level2">
<h2><span class="header-section-number">11.5</span> Peaks list</h2>
<p>Then we could extract the peaks list from <code>xcmsSet</code> objects.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(enviGCMS)
<span class="co"># get the xcmsset object</span>
neg &lt;-<span class="st"> </span><span class="kw">getrtmz</span>(<span class="st">&#39;D:/metademo/data/&#39;</span>)
<span class="co"># back up the xcmsset object</span>
<span class="kw">save</span>(neg,<span class="dt">file =</span> <span class="st">&#39;neg.Rdata&#39;</span>)
<span class="co"># get the number</span>
npeaks &lt;-<span class="st"> </span><span class="kw">nrow</span>(neg<span class="op">@</span>groups)
<span class="co"># get the EIC, boxplot and diffreport, eixmax should be equal to the numbers of peaks groups in the pos objects </span>
report &lt;-<span class="st"> </span>CAMERA<span class="op">::</span><span class="kw">annotateDiffreport</span>(neg,<span class="dt">filebase =</span> <span class="st">&#39;peaklistneg&#39;</span>,<span class="dt">metlin =</span> T, <span class="dt">eicmax =</span> npeaks, <span class="dt">classeic =</span> neg<span class="op">@</span>phenoData<span class="op">$</span>class)
<span class="co"># save the report as a csv file</span>
<span class="kw">write.csv</span>(report,<span class="dt">file =</span> <span class="st">&#39;all.csv&#39;</span>)</code></pre>
</div>
<div id="peaks-filtering" class="section level2">
<h2><span class="header-section-number">11.6</span> Peaks filtering</h2>
<p>After we get the peaks list, it’s nessary to filter the peaks list to retain the peaks with high quality for further analysis. Normally, we could use the relative standard deviation of blank and pooled QC samples to control the peaks list.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&#39;neg.Rdata&#39;</span>)
<span class="co"># get the peak intensity, m/z, retention time and group information as list</span>
mzrt &lt;-<span class="st"> </span>enviGCMS<span class="op">::</span><span class="kw">getmzrt</span>(neg)
<span class="co"># get the mean and rsd for each group</span>
mzrtm &lt;-<span class="st"> </span>enviGCMS<span class="op">::</span><span class="kw">getdoe</span>(mzrt)
gm &lt;-<span class="st"> </span>mzrtm<span class="op">$</span>groupmean
gr &lt;-<span class="st"> </span>mzrtm<span class="op">$</span>grouprsd
<span class="co"># find the blank group and pool QC group</span>
blk &lt;-<span class="st"> </span><span class="kw">grepl</span>(<span class="st">&#39;k&#39;</span>,<span class="kw">colnames</span>(gm))
pqc &lt;-<span class="st"> </span><span class="kw">grepl</span>(<span class="st">&#39;q&#39;</span>,<span class="kw">colnames</span>(gm))
<span class="co"># filter by pool QC and blank&#39;s group mean intensity(pool QC should larger than three times of blank), return numbers and index</span>
<span class="kw">sum</span>(indexmean &lt;-<span class="st"> </span><span class="kw">apply</span>(gm,<span class="dv">1</span>,<span class="cf">function</span>(x) <span class="kw">all</span>(x[pqc]<span class="op">&gt;=</span><span class="st"> </span><span class="dv">3</span><span class="op">*</span>x[blk])))
<span class="co"># filt by pool qc rsd%, return numbers and index</span>
rsdcf &lt;-<span class="st"> </span><span class="dv">30</span>
<span class="kw">sum</span>(indexrsd &lt;-<span class="st"> </span><span class="kw">apply</span>(gr,<span class="dv">1</span>,<span class="cf">function</span>(x) <span class="kw">ifelse</span>(<span class="kw">is.na</span>(x[pqc]),T,x[pqc]<span class="op">&lt;</span>rsdcf)))
<span class="co"># overlap with rsd% and mean filter</span>
<span class="kw">sum</span>(index &lt;-<span class="st"> </span>indexmean<span class="op">&amp;</span>indexrsd)

<span class="co"># new list, update group and remove pool qc/blk</span>
qcindex &lt;-<span class="st"> </span><span class="kw">grepl</span>(<span class="st">&#39;k&#39;</span>,mzrt<span class="op">$</span>group<span class="op">$</span>class) <span class="op">|</span><span class="st"> </span><span class="kw">grepl</span>(<span class="st">&#39;q&#39;</span>,mzrt<span class="op">$</span>group<span class="op">$</span>class)
mzrtfilter &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">data =</span> mzrt<span class="op">$</span>data[index,<span class="op">!</span>qcindex],
                   <span class="dt">mz =</span> mzrt<span class="op">$</span>mz[index],
                   <span class="dt">rt =</span> mzrt<span class="op">$</span>rt[index],
                   <span class="dt">group =</span> <span class="kw">droplevels</span>(mzrt<span class="op">$</span>group<span class="op">$</span>class[<span class="op">!</span>qcindex,<span class="dt">drop =</span>T]))
<span class="co"># get the filtered csv</span>
enviGCMS<span class="op">::</span><span class="kw">getupload</span>(mzrtfilter,<span class="dt">name =</span> <span class="st">&#39;peakfilter&#39;</span>)</code></pre>
</div>
<div id="normalization-optional" class="section level2">
<h2><span class="header-section-number">11.7</span> Normalization (Optional)</h2>
<p>Normailizaiton is nesscery if you data are collected at different batch or runned in differen instrument parameters.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># visulize the batch effect</span>
mzrtsim<span class="op">::</span><span class="kw">rlaplot</span>(mzrt<span class="op">$</span>data,<span class="dt">lv =</span> mzrt<span class="op">$</span>group<span class="op">$</span>class)
mzrtsim<span class="op">::</span><span class="kw">ridgesplot</span>(mzrt<span class="op">$</span>data,<span class="dt">lv =</span> mzrt<span class="op">$</span>group<span class="op">$</span>class)
<span class="co"># get the simulation data and test on NOREVA</span>
sim &lt;-<span class="st"> </span>mzrtsim<span class="op">::</span><span class="kw">simmzrt</span>(mzrt<span class="op">$</span>data)
mzrtsim<span class="op">::</span><span class="kw">simdata</span>(sim)
<span class="co"># correct the batch effect by sva</span>
mzrtcor &lt;-<span class="st"> </span>mzrtsim<span class="op">::</span><span class="kw">svacor</span>(mzrt<span class="op">$</span>data,<span class="dt">lv =</span> mzrt<span class="op">$</span>group<span class="op">$</span>class)
<span class="co"># visulize the batch effect correction</span>
li &lt;-<span class="st"> </span>mzrtsim<span class="op">::</span><span class="kw">limmaplot</span>(mzrtcor,<span class="dt">lv =</span> mzrt<span class="op">$</span>group<span class="op">$</span>class)
<span class="co"># return the corrected data</span>
mzrt<span class="op">$</span>data &lt;-<span class="st"> </span>mzrtcor<span class="op">$</span>dataCorrected</code></pre>
</div>
<div id="statistic-analysis" class="section level2">
<h2><span class="header-section-number">11.8</span> Statistic analysis</h2>
<p>Here we could use <code>caret</code> package to perform statistical analysis.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(caret)
<span class="co">## Spliting data</span>
trainIndex &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(mzrtfilter<span class="op">$</span>data, <span class="dt">p =</span> <span class="fl">.8</span>, 
                                  <span class="dt">list =</span> <span class="ot">FALSE</span>, 
                                  <span class="dt">times =</span> <span class="dv">1</span>)
<span class="co">## Get the training and testing datasets</span>
Train &lt;-<span class="st"> </span>data[ trainIndex,]
Test  &lt;-<span class="st"> </span>data[<span class="op">-</span>trainIndex,]
<span class="co">## Set the cross validation method</span>
fitControl &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="co">## 10-fold CV</span>
                           <span class="dt">method =</span> <span class="st">&quot;repeatedcv&quot;</span>,
                           <span class="dt">number =</span> <span class="dv">10</span>,
                           <span class="co">## repeated ten times</span>
                           <span class="dt">repeats =</span> <span class="dv">10</span>)
<span class="co"># extra papameters for GBM </span>
gbmGrid &lt;-<span class="st">  </span><span class="kw">expand.grid</span>(<span class="dt">interaction.depth =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">9</span>), 
                        <span class="dt">n.trees =</span> (<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>)<span class="op">*</span><span class="dv">50</span>, 
                        <span class="dt">shrinkage =</span> <span class="fl">0.1</span>,
                        <span class="dt">n.minobsinnode =</span> <span class="dv">20</span>)

<span class="kw">set.seed</span>(<span class="dv">825</span>)
gbmFit &lt;-<span class="st"> </span><span class="kw">train</span>(mzrtfilter<span class="op">$</span>group <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> training, 
                 <span class="dt">method =</span> <span class="st">&quot;gbm&quot;</span>, 
                 <span class="dt">trControl =</span> fitControl, 
                 <span class="dt">verbose =</span> <span class="ot">FALSE</span>, 
                 <span class="co">## Now specify the exact models </span>
                 <span class="co">## to evaluate:</span>
                 <span class="dt">tuneGrid =</span> gbmGrid)
<span class="co"># show the fitting process</span>
<span class="kw">plot</span>(gbmFit)  
<span class="co"># ANOVA analysis for model selection</span>
<span class="kw">anova</span>(fit1,fit2)
<span class="co"># find the important variables</span>
Imp &lt;-<span class="st"> </span><span class="kw">varImp</span>(fit)
<span class="kw">plot</span>(Imp)</code></pre>
</div>
<div id="annotation-1" class="section level2">
<h2><span class="header-section-number">11.9</span> Annotation</h2>
<p>Here I use <code>xMSannotator</code> package to make annotation with HMDB as reference database.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(xMSannotator)
num_nodes =<span class="st"> </span><span class="dv">10</span>
<span class="kw">data</span>(<span class="st">&quot;adduct_weights&quot;</span>)
negsub &lt;-<span class="st"> </span><span class="kw">getrtmz</span>(<span class="st">&#39;D:/metademo/data/oq/&#39;</span>)
anno &lt;-<span class="st"> </span>xsetplus<span class="op">::</span><span class="kw">fanno</span>(negsub,<span class="dt">outloc =</span> <span class="st">&#39;D:/metademo/anno&#39;</span>,<span class="dt">mode =</span> <span class="st">&#39;neg&#39;</span>)</code></pre>
</div>
<div id="pathway-analysis-1" class="section level2">
<h2><span class="header-section-number">11.10</span> Pathway Analysis</h2>
<p>We could output the files for online pathway analysis with mummichog algorithm.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get the file</span>
xsetplus<span class="op">::</span><span class="kw">mumdata</span>(neg,<span class="dt">lv =</span> mzrt<span class="op">$</span>group<span class="op">$</span>class)
<span class="co"># http://mummichog.org/index.html</span>
<span class="co"># mummichog1 -f &#39;test.txt&#39; -o myResult</span></code></pre>
</div>
<div id="metaboanalyst" class="section level2">
<h2><span class="header-section-number">11.11</span> MetaboAnalyst</h2>
<p>Actully, after you perform data correction, you have got the data matrix for statistic analysis. You might choose <a href="http://www.metaboanalyst.ca/MetaboAnalyst/faces/docs/Contact.xhtml"><strong>MetaboAnalyst</strong></a> online or offline to make furthor analysis, which supplied more statistical choices than xcms.</p>
<p>The input data format for <strong>MetaboAnalyst</strong> should be rows for peaks and colomns for samples. You could also add groups infomation if possible. Use the following code to get the data for analysis.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get the csv file for Metaboanalyst.ca</span>
enviGCMS<span class="op">::</span><span class="kw">getupload</span>(neg,<span class="dt">name =</span> <span class="st">&#39;metabo&#39;</span>)</code></pre>
</div>
<div id="summary" class="section level2">
<h2><span class="header-section-number">11.12</span> Summary</h2>
<p>This is the offline metaboliomics data process workflow. For each study, details would be different and F1 is always your best friend.</p>
<p>Enjoy yourself in data mining!</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="workflow-2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exposome.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/yufree/metaworkflow/edit/master/10-workflow.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
